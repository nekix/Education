# Бизнес-правила системы управления автопарком

## 1. ОБЩИЕ ПРИНЦИПЫ

### 1.1 Принцип изоляции данных
Каждый менеджер имеет доступ только к данным предприятий, которыми он управляет. Межтенантное взаимодействие запрещено.

### 1.2 Принцип минимальных привилегий
Менеджер может выполнять операции только с объектами, принадлежащими управляемым им предприятиям.

### 1.3 Принцип целостности данных
Система предотвращает нарушение ссылочной целостности и обеспечивает соблюдение бизнес-ограничений.

## 2. АВТОМОБИЛИ

### 2.1 Создание автомобиля
**Разрешено:**
- Создание автомобиля в предприятии, которым управляет менеджер

**Запрещено:**
- Создание автомобиля в предприятии, которым менеджер не управляет

**Ограничения:**
- Назначаемые водители должны быть сотрудниками того же предприятия
- Активный водитель должен быть в списке назначенных водителей

### 2.2 Изменение автомобиля
**Разрешено:**
- Изменение характеристик автомобиля своего предприятия
- Перенос автомобиля между предприятиями, которыми управляет менеджер
- Изменение назначенных водителей из целевого предприятия

**Запрещено:**
- Изменение автомобилей других предприятий
- Перенос автомобиля в предприятие, которым менеджер не управляет

**Ограничения:**
- Назначаемые водители должны быть сотрудниками целевого предприятия
- Активный водитель должен быть в списке назначенных водителей

### 2.3 Удаление автомобиля
**Разрешено:**
- Удаление автомобиля из своего предприятия

**Запрещено:**
- Удаление автомобилей других предприятий
- Удаление автомобиля при наличии активных связей с водителями

## 3. ПРЕДПРИЯТИЯ

### 3.1 Удаление предприятия
**Разрешено:**
- Удаление предприятия при единоличном управлении (менеджер является единственным управляющим)
- Удаление только при отсутствии автомобилей и водителей

**Запрещено:**
- Удаление предприятия, которым управляют другие менеджеры
- Удаление предприятия с автомобилями
- Удаление предприятия с водителями
- Удаление предприятия, которым менеджер не управляет

## 4. МОДЕЛИ АВТОМОБИЛЕЙ

### 4.1 Текущие правила
??? **СПОРНАЯ КОНЦЕПЦИЯ** Модели являются глобальными справочными данными. Любой авторизованный менеджер может создавать, изменять и удалять модели.

### 4.2 Ограничения на удаление
**Запрещено:**
- Удаление модели, используемой в существующих автомобилях

**Примечание:** Спорные вопросы по правам доступа к моделям описаны в отдельном документе.

## 5. ВОДИТЕЛИ

### 5.1 Принадлежность предприятию
Водители жестко привязаны к предприятию. Смена предприятия не предусмотрена.

### 5.2 Назначение на автомобили
**Ограничения:**
- Водитель может быть назначен только на автомобили своего предприятия
- Один водитель может быть назначен на несколько автомобилей
- На одном автомобиле может быть несколько назначенных водителей
- Активным может быть только один водитель на автомобиле

## 6. СИСТЕМА ОГРАНИЧЕНИЙ

### 6.1 Ссылочная целостность
Система предотвращает удаление объектов при наличии зависимых сущностей:
- Нельзя удалить модель, используемую в автомобилях
- Нельзя удалить предприятие с автомобилями или водителями
- Нельзя удалить автомобиль с назначенными водителями

### 6.2 Логическая консистентность
- Активный водитель должен быть в списке назначенных водителей
- Водители и автомобиль должны принадлежать одному предприятию
- Менеджер может удалить предприятие только при единоличном управлении

## 7. ПОЛИТИКИ ДОСТУПА

### 7.1 Авторизация
Все операции изменения данных требуют авторизации менеджера.

### 7.2 Фильтрация данных
При получении списков данных система автоматически фильтрует результаты по предприятиям, которыми управляет менеджер.

### 7.3 Проверка прав
Перед выполнением любой операции изменения система проверяет права доступа менеджера к соответствующим объектам.

## 8. ИСКЛЮЧИТЕЛЬНЫЕ СИТУАЦИИ

### 8.1 Нарушение прав доступа
При попытке выполнения операции с объектом, к которому у менеджера нет доступа, операция отклоняется.

### 8.2 Нарушение бизнес-правил
При попытке выполнения операции, нарушающей бизнес-ограничения, операция отклоняется с описанием причины.

### 8.3 Нарушение ссылочной целостности
При попытке удаления объекта с зависимыми сущностями операция отклоняется.
